# API-документация

## Описание
REST API для управления опросами и пользователями. Использует сессионную авторизацию. Все запросы, кроме `/api/register/` и `/api/login/`, требуют авторизации. Доступ регулируется через `IsAuthenticated` и `IsAdminOrReadOnly`.

## Эндпоинты

### Пользователи

#### Регистрация
- **POST /api/register/**  
  Создаёт нового пользователя и логинит его.  
  **Запрос**: `{"username": "user1", "email": "user1@example.com", "password": "pass123"}`  
 **Ответ**: `201 Created` `{"id": 1, "username": "user1", "email": "user1@example.com"}`

#### Вход
- **POST /api/login/**  
Логинит пользователя, создавая сессию.  
**Запрос**: `{"username": "user1", "password": "pass123"}`
**Ответ**: `200 OK` `{"message": "Вы успешно вошли"}`

#### Выход
- **POST /api/logout/**  
Завершает сессию пользователя.  
**Требуется авторизация**.  
**Ответ**: `204 No Content`

#### Смена пароля
- **POST /api/change-password/**  
Меняет пароль текущего пользователя.  
**Требуется авторизация**.  
**Запрос**: `{"old_password": "pass123", "new_password": "newpass456"}`
**Ответ**: `200 OK` `{"message": "Пароль успешно изменён"}`

#### Сброс пароля
- **POST /api/reset-password/**  
Админ сбрасывает пароль пользователя.  
**Требуется авторизация и права админа**.  
**Запрос**: `{"user_id": 1, "new_password": "reset789"}`
**Ответ**: `200 OK` `{"message": "Пароль успешно сброшен"}`

#### Список пользователей
- **GET /api/users/**  
Возвращает список всех пользователей.  
**Требуется авторизация и права админа**.  
**Ответ**: `200 OK` `[{"id": 1, "username": "user1", "email": "user1@example.com"}]`

### Опросы

#### Список опросов
- **GET /api/surveys/**  
Возвращает все опросы (активные и завершённые).  
**Требуется авторизация**.  
**Фильтры**: `?questions=<id>`  
**Сортировка**: `?ordering=start_date` (или `-start_date`, `end_date`, `-end_date`)  
**Ответ**: `200 OK` `[{"id": 1, "title": "Тестовый опрос", "description": "Описание", "start_date": "2025-03-01", "end_date": "2025-03-10", "is_active": true}]`

#### Создание опроса
- **POST /api/surveys/**  
Создаёт новый опрос.  
**Требуется авторизация и права админа**.  
**Запрос**: `{"title": "Новый опрос", "description": "Описание", "start_date": "2025-03-03", "end_date": "2025-03-10", "is_active": true}`
**Ответ**: `201 Created` `{"id": 2, "title": "Новый опрос", "description": "Описание", "start_date": "2025-03-03", "end_date": "2025-03-10", "is_active": true}`

#### Статистика опроса
- **GET /api/surveys/<survey_id>/statistics/**  
Возвращает статистику ответов по опросу.  
**Требуется авторизация и права админа**.  
**Ответ**: `200 OK` `{"total_responses": 5, "by_question": {"Вопрос 1": {"type": "single", "responses": 3, "options": {"Да": 2, "Нет": 1}}}}`

### Вопросы и ответы

#### Создание вопроса
- **POST /api/questions/**  
Добавляет вопрос к опросу.  
**Требуется авторизация и права админа**.  
**Запрос**: `{"survey": 1, "text": "Ваш вопрос?", "question_type": "single"}`
**Ответ**: `201 Created`

#### Создание варианта ответа
- **POST /api/answers/**  
Добавляет вариант ответа к вопросу.  
**Требуется авторизация и права админа**.  
**Запрос**: `{"question": 1, "text": "Да"}`
**Ответ**: `201 Created`

#### Отправка ответа
- **POST /api/responses/**  
Сохраняет ответ пользователя.  
**Требуется авторизация**.  
**Запрос**: `{"question": 1, "selected_option": 1}`
**Ответ**: `201 Created`
